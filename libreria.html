<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Diccionario de Acordes - PUMUCHORDS</title>
    <style>
        :root {
            --bg-color: #2c3e50; --accent: #e67e22; --card-bg: #f8f9fa;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: white; padding: 20px; text-align: center; }
        
        .filters { background: #34495e; padding: 20px; border-radius: 12px; margin-bottom: 30px; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
        .filter-group { display: flex; flex-direction: column; align-items: flex-start; }
        label { font-size: 10px; text-transform: uppercase; opacity: 0.7; margin-bottom: 5px; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 20px; padding: 10px; }
        
        .chord-box { background: white; border-radius: 8px; padding: 10px; color: #333; transition: transform 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .chord-box:hover { transform: translateY(-5px); }
        .chord-name { font-weight: 800; font-size: 16px; color: var(--accent); border-bottom: 1px solid #eee; margin-bottom: 8px; }
        .chord-fret-str { font-family: monospace; font-size: 9px; color: #7f8c8d; margin-top: 5px; }

        select { padding: 8px 12px; border-radius: 5px; background: #2c3e50; color: white; border: 1px solid var(--accent); font-weight: bold; cursor: pointer; }
        .btn-back { display: inline-block; margin-bottom: 20px; color: white; text-decoration: none; font-size: 12px; border: 1px solid white; padding: 5px 10px; border-radius: 5px; }
    </style>
</head>
<body>

    <a href="index.html" class="btn-back">← Volver al Generador</a>
    <h1>Diccionario de Acordes</h1>

    <div class="filters">
        <div class="filter-group">
            <label>Nota Raíz</label>
            <select id="rootFilter">
                <option value="ALL">Todas las notas</option>
            </select>
        </div>
        <div class="filter-group">
            <label>Tipo de Acorde</label>
            <select id="typeFilter">
                <option value="ALL">Todos los tipos</option>
            </select>
        </div>
    </div>

    <div id="chordGrid" class="grid">
        </div>

    <script>
        const notes = ['Do', 'Do#', 'Re', 'Re#', 'Mi', 'Fa', 'Fa#', 'Sol', 'Sol#', 'La', 'La#', 'Si'];
        let libreriaManual = null;

        async function cargarLibreria() {
            try {
                const res = await fetch('Acordes2.json');
                libreriaManual = await res.json();
                poblarFiltros();
                render();
            } catch (e) {
                document.getElementById('chordGrid').innerHTML = "Error cargando Acordes2.json";
            }
        }

        function poblarFiltros() {
            const rootSel = document.getElementById('rootFilter');
            const typeSel = document.getElementById('typeFilter');

            // Notas
            notes.forEach(n => rootSel.innerHTML += `<option value="${n}">${n}</option>`);

            // Tipos (lee las llaves del JSON: M, m, 7, 6, etc)
            Object.keys(libreriaManual).forEach(t => {
                typeSel.innerHTML += `<option value="${t}">${t}</option>`;
            });

            rootSel.onchange = render;
            typeSel.onchange = render;
        }

        function render() {
            const grid = document.getElementById('chordGrid');
            const rootVal = document.getElementById('rootFilter').value;
            const typeVal = document.getElementById('typeFilter').value;
            grid.innerHTML = "";

            // Recorremos el JSON según los filtros
            for (let typeKey in libreriaManual) {
                if (typeVal !== "ALL" && typeVal !== typeKey) continue;

                for (let noteKey in libreriaManual[typeKey]) {
                    if (rootVal !== "ALL" && rootVal !== noteKey) continue;

                    const posiciones = libreriaManual[typeKey][noteKey];
                    
                    posiciones.forEach(pos => {
                        // Construimos el nombre legible
                        let displayType = typeKey === "M" ? "" : typeKey;
                        const card = document.createElement('div');
                        card.className = "chord-box";
                        card.innerHTML = `
                            <div class="chord-name">${noteKey}${displayType}</div>
                            ${drawSVG(pos.split('-'))}
                            <div class="chord-fret-str">${pos}</div>
                        `;
                        grid.appendChild(card);
                    });
                }
            }
        }

        function drawSVG(frets) {
            const numeric = frets.filter(f => f.toLowerCase() !== 'x').map(f => parseInt(f));
            const pressedFrets = numeric.filter(f => f > 0);
            let startFret = pressedFrets.length > 0 ? Math.min(...pressedFrets) : 1;
            let svg = `<svg width="80" height="100" viewBox="0 0 120 130">
                <text x="5" y="45" font-size="16" fill="#e67e22" font-weight="bold">${startFret}</text>
                <rect x="35" y="25" width="60" height="80" fill="none" stroke="#333" stroke-width="2"/>
                ${[45,65,85].map(y => `<line x1="35" y1="${y}" x2="95" y2="${y}" stroke="#ccc"/>`).join('')}
                ${[35,47,59,71,83,95].map(x => `<line x1="${x}" y1="25" x2="${x}" y2="105" stroke="#333"/>`).join('')}`;
            frets.forEach((f, i) => {
                const x = 35 + (i * 12);
                if (f.toLowerCase() === 'x') svg += `<text x="${x-4}" y="18" font-size="12" fill="red">×</text>`;
                else if (f == '0') svg += `<circle cx="${x}" cy="15" r="4" fill="none" stroke="green"/>`;
                else {
                    const y = 25 + ((parseInt(f) - startFret + 1) * 20) - 10;
                    if (y >= 25 && y <= 105) svg += `<circle cx="${x}" cy="${y}" r="7" fill="#333"/>`;
                }
            });
            return svg + "</svg>";
        }

        cargarLibreria();
    </script>
</body>
</html>
