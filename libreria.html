<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Diccionario de Acordes - PUMUCHORDS</title>
    <style>
        :root {
            --bg-color: #2c3e50; --accent: #e67e22; --card-bg: #ffffff;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: white; padding: 20px; text-align: center; margin: 0; }
        
        .filters { background: #34495e; padding: 20px; border-radius: 12px; margin-bottom: 30px; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; position: sticky; top: 10px; z-index: 100; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .filter-group { display: flex; flex-direction: column; align-items: flex-start; }
        label { font-size: 10px; text-transform: uppercase; opacity: 0.7; margin-bottom: 5px; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 20px; padding: 10px; }
        
        /* Estilo de la tarjeta */
        .chord-box { 
            background: var(--card-bg); border-radius: 8px; padding: 15px; color: #333; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            box-shadow: 0 4px 6px rgba(0,0,0,0.3); cursor: zoom-in;
            position: relative; z-index: 1;
        }

        .chord-name { font-weight: 800; font-size: 18px; color: var(--accent); border-bottom: 2px solid #eee; margin-bottom: 10px; padding-bottom: 5px; }
        .chord-fret-str { font-family: monospace; font-size: 10px; color: #7f8c8d; margin-top: 8px; background: #eee; padding: 2px; border-radius: 3px; }

        /* EFECTO ZOOM */
        .chord-box.expanded {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(2.2);
            z-index: 1000;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            cursor: zoom-out;
        }

        /* Fondo oscuro cuando hay zoom */
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none; z-index: 999;
            backdrop-filter: blur(3px);
        }

        select { padding: 8px 12px; border-radius: 5px; background: #2c3e50; color: white; border: 1px solid var(--accent); font-weight: bold; cursor: pointer; }
        .btn-back { display: inline-block; margin-bottom: 20px; color: white; text-decoration: none; font-size: 14px; border: 1px solid white; padding: 8px 15px; border-radius: 5px; transition: 0.3s; }
        .btn-back:hover { background: white; color: var(--bg-color); }
    </style>
</head>
<body>

    <div id="overlay"></div>

    <a href="index.html" class="btn-back">← Volver al Generador</a>
    <h1>Diccionario de Acordes</h1>

    <div class="filters">
        <div class="filter-group">
            <label>Nota Raíz</label>
            <select id="rootFilter"><option value="ALL">Todas las notas</option></select>
        </div>
        <div class="filter-group">
            <label>Tipo de Acorde</label>
            <select id="typeFilter"><option value="ALL">Todos los tipos</option></select>
        </div>
        <div style="align-self: flex-end; font-size: 11px; opacity: 0.6; padding-bottom: 10px;">
            Pulsa un acorde para ampliarlo
        </div>
    </div>

    <div id="chordGrid" class="grid"></div>

    <script>
        const notes = ['Do', 'Do#', 'Re', 'Re#', 'Mi', 'Fa', 'Fa#', 'Sol', 'Sol#', 'La', 'La#', 'Si'];
        let libreriaManual = null;
        const overlay = document.getElementById('overlay');

        async function cargarLibreria() {
            try {
                const res = await fetch('Acordes2.json');
                libreriaManual = await res.json();
                poblarFiltros();
                render();
            } catch (e) {
                document.getElementById('chordGrid').innerHTML = "Error cargando Acordes2.json";
            }
        }

        function poblarFiltros() {
            const rootSel = document.getElementById('rootFilter');
            const typeSel = document.getElementById('typeFilter');
            notes.forEach(n => rootSel.innerHTML += `<option value="${n}">${n}</option>`);
            Object.keys(libreriaManual).forEach(t => {
                typeSel.innerHTML += `<option value="${t}">${t}</option>`;
            });
            rootSel.onchange = render;
            typeSel.onchange = render;
        }

        function render() {
            const grid = document.getElementById('chordGrid');
            const rootVal = document.getElementById('rootFilter').value;
            const typeVal = document.getElementById('typeFilter').value;
            grid.innerHTML = "";

            for (let typeKey in libreriaManual) {
                if (typeVal !== "ALL" && typeVal !== typeKey) continue;
                for (let noteKey in libreriaManual[typeKey]) {
                    if (rootVal !== "ALL" && rootVal !== noteKey) continue;

                    libreriaManual[typeKey][noteKey].forEach(pos => {
                        let displayType = typeKey === "M" ? "" : typeKey;
                        const card = document.createElement('div');
                        card.className = "chord-box";
                        card.innerHTML = `
                            <div class="chord-name">${noteKey}${displayType}</div>
                            ${drawSVG(pos.split('-'))}
                            <div class="chord-fret-str">${pos}</div>
                        `;
                        
                        // EVENTO CLIC PARA ZOOM
                        card.onclick = (e) => {
                            e.stopPropagation();
                            const isExpanded = card.classList.contains('expanded');
                            
                            // Cerrar cualquier otro abierto
                            document.querySelectorAll('.chord-box').forEach(c => c.classList.remove('expanded'));
                            
                            if (!isExpanded) {
                                card.classList.add('expanded');
                                overlay.style.display = 'block';
                            } else {
                                overlay.style.display = 'none';
                            }
                        };

                        grid.appendChild(card);
                    });
                }
            }
        }

        // Cerrar al hacer clic en el fondo
        overlay.onclick = () => {
            document.querySelectorAll('.chord-box').forEach(c => c.classList.remove('expanded'));
            overlay.style.display = 'none';
        };

        function drawSVG(frets) {
            const numeric = frets.filter(f => f.toLowerCase() !== 'x').map(f => parseInt(f));
            const pressedFrets = numeric.filter(f => f > 0);
            let startFret = pressedFrets.length > 0 ? Math.min(...pressedFrets) : 1;
            let svg = `<svg width="80" height="100" viewBox="0 0 120 130">
                <text x="5" y="45" font-size="16" fill="#e67e22" font-weight="bold">${startFret}</text>
                <rect x="35" y="25" width="60" height="80" fill="none" stroke="#333" stroke-width="2"/>
                ${[45,65,85].map(y => `<line x1="35" y1="${y}" x2="95" y2="${y}" stroke="#ccc"/>`).join('')}
                ${[35,47,59,71,83,95].map(x => `<line x1="${x}" y1="25" x2="${x}" y2="105" stroke="#333"/>`).join('')}`;
            frets.forEach((f, i) => {
                const x = 35 + (i * 12);
                if (f.toLowerCase() === 'x') svg += `<text x="${x-4}" y="18" font-size="12" fill="red">×</text>`;
                else if (f == '0') svg += `<circle cx="${x}" cy="15" r="4" fill="none" stroke="green"/>`;
                else {
                    const y = 25 + ((parseInt(f) - startFret + 1) * 20) - 10;
                    if (y >= 25 && y <= 105) svg += `<circle cx="${x}" cy="${y}" r="7" fill="#333"/>`;
                }
            });
            return svg + "</svg>";
        }

        cargarLibreria();
    </script>
</body>
</html>
